<!-- <script src="script/warehouse/collect.js" type="text/javascript"></script> -->
<script type="text/javascript">
    //对玩家收藏数组更改储存格式，以方便在js中调用
    function arrCollToObj() {
        //console.log("正在读取玩家收藏内容。。。");
        playerCollects = {};

        if (playerCollect[playerIndex] == undefined) {	//如果玩家下标对应的数组没有任何东西，创建一个新的数组
            playerCollect[playerIndex] = [[playerName, steamID]];
            //console.log("创建收藏数组")
        }
        //console.log(playerCollect[playerIndex])
        playerCollects.data = [playerCollect[playerIndex]];
        for (var i = 1; i < playerCollect[playerIndex].length; i++) {	//遍历当前登录玩家的收藏数组
            //下面3个数据能指定唯一的商品
            playerCollects.data[i] = {}
            //console.log(playerCollect[playerIndex])
            playerCollects.data[i].id = playerCollect[playerIndex][i][0];		//物品ID
            playerCollects.data[i].quality = playerCollect[playerIndex][i][1].split(":")[1];//物品品质
            playerCollects.data[i].num = playerCollect[playerIndex][i][2].split(":")[1];	//物品售卖数量

            //下面是要根据ID从商品数据中获取其它内容 以便于在页面给玩家显示
            var id = playerCollects.data[i].id;		//收藏物品的ID
            var qua = playerCollects.data[i].quality * 1;	//收藏物品的品质
            var num = playerCollects.data[i].num * 1;		//收藏物品的售卖数量
            var find = false;	//默认为在商品列表中没有找到可匹配的商品
            for (var j = 0; j < shop.data.length; j++) {	//遍历所有商品
                if (shop.data[j].show == "true" || shop.data[j].show == "auto") {		//只匹配在页面显示的商品
                    var sID = shop.data[j].id;		//获取商品ID
                    var sQua = shop.data[j].quality * 1;	//获取商品品质
                    var sNum = shop.data[j].num * 1;	//获取商品数量
                    //如果3条数据同时匹配正确，说明收藏的就是这个商品
                    if (sID == id && sQua == qua && sNum == num) {
                        //console.log(id+"---"+sNum+"---"+num);
                        playerCollects.data[i].xb = j;	//保存物品在商品列表中的下标，以方便以后调用
                        playerCollects.data[i].name = shop.data[j].name;	//获取商品名称
                        playerCollects.data[i].image = shop.data[j].image;	//获取商品图片
                        playerCollects.data[i].class = shop.data[j].class1;	//获取物品分类
                        playerCollects.data[i].currency = shop.data[j].currency;	//获取货币类型
                        //下面要根据设置的折扣来显示实际的价格
                        if (shop.data[j].discount < 10 && shop.data[j].discount > 0) {		//如果折扣在0~10之间
                            var price = Math.round(shop.data[j].price * shop.data[j].discount / 10);	//计算出折扣后的价格（优惠价）
                            playerCollects.data[i].price = price;	//显示的价格为折扣后的价格
                            //console.log("折扣价");
                        } else if (shop.data[j].discount == "auto" || shop.data[j].discount == "true") {	//如果折扣设置的是"auto"或"true"
                            var price = shop.data[j].prefer;
                            playerCollects.data[i].price = price;	//显示的价格为优惠价
                            //console.log("优惠价");
                        } else {	//其它情况直接用原本的价格
                            playerCollects.data[i].price = shop.data[j].price;
                            //console.log("原价");
                        }
                        playerCollects.data[i].collect = shop.data[j].collect;	//获取收藏数量
                        find = true;
                        break;
                    }
                }
            }
            //如果遍历完数组后仍然没匹配到商品，说明收藏的这个物品在商品列表中不存在。（这个商品可能被修改过或者已删除）
            if (!find) {
                playerCollects.data[i].xb = undefined;
                playerCollects.data[i].name = queryItems(true, id).name;
                playerCollects.data[i].image = "images/alert.png";
                //playerCollects.data[i].num = 0;
                playerCollects.data[i].currency = "积分";
                playerCollects.data[i].price = "物品已失效";
                playerCollects.data[i].collect = 1;
            }
        }
    }

    arrCollToObj();
</script>
<script src="script/shop.js" type="text/javascript"></script>        <!-- 商店主页面:商品列表 -->
<script src="script/shop-nav.js" type="text/javascript"></script>    <!-- 商店主页面:左侧导航栏 -->
<script src="script/details.js" type="text/javascript"></script>    <!-- 商店主页面:商品详情 -->

