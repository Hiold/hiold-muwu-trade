import{h as a}from"./moment.08a7f518.js";import{A as e,$ as t,E as l,G as i,L as d,b as o,p as s,a as r,r as n,o as c,c as m,f as u,g as h,t as w,l as p,F as D,i as y,w as f}from"./vendor.e2554b35.js";import{_ as g}from"./AawrdComponent.7d3777ad.js";const b={name:"ItemexchangeComponent",components:{AawrdComponent:g},data:()=>({fid:"5",cid:"",ctx:{},itemNameCache:[],instance:!1,editor:"",speitems:{},selectspeitem:"",awardInfo:[],awardAddVisible:!1,awardData:{id:"-1",type:"",count:"",itemname:"",itemquality:"",itemchinese:"",itemicon:"",itemtint:"",command:"",couDate:[a().format("YYYY-MM-DD HH:mm:ss"),a().add("7","days").format("YYYY-MM-DD HH:mm:ss")],couCurrType:"",couPrice:"",couCond:"",coudatelimit:"",couDateStart:"",couDateEnd:"",desc:"",crafttime:""},marks:{0:{style:{color:"#1989FA"},label:"无品质"},1:{style:{color:"rgb(157, 138, 106)"},label:"1品质"},2:{style:{color:"rgb(208, 129, 43)"},label:"2品质"},3:{style:{color:"rgb(163, 165, 28)"},label:"3品质"},4:{style:{color:"rgb(69, 195, 54)"},label:"4品质"},5:{style:{color:"rgb(51, 96, 207)"},label:"5品质"},6:{style:{color:"rgb(165, 44, 205)"},label:"6"}}}),mounted(){this.ctx=e(),this.initTableData(),this.initTempateSPE()},methods:{handleEdtor(){if(!this.instance){console.log(t("#editor")),this.editor=new wangEditor("#editor");let a=this;this.editor.config.onchange=function(e){a.awardData.desc=e},this.editor.config.onchangeTimeout=100,this.editor.create(),this.instance=!0}},initTempateSPE(){l.post("api/getAwardInfo",{containerid:"0",funcid:"0"}).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.speitems=e}}))},initTableData(){l.post("api/getExchange",{type:"'1','2','3','4'",searchType:"制作物",page:"1",limit:"10"}).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.awardInfo=e}}))},resetForm(a){this.$refs[a].resetFields()},submitAddForm(a){this.$refs[a].validate((a=>{if(!a)return!1;{let a="";a="-1"==this.awardData.id?"api/postExchange":"api/updateExchange",this.awardData.itemquality=this.awardData.itemquality+"",this.awardData.couDate&&2===this.awardData.couDate.length&&(this.awardData.couDateStart=this.awardData.couDate[0],this.awardData.couDateEnd=this.awardData.couDate[1],this.awardData.couDate=""),l.post(a,this.awardData).then((a=>{"1"===a.data.respCode?i({message:"保存成功!",type:"success"}):i.error("保存出错"),l.post("api/getExchange",args).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.awardInfo=e,this.awardAddVisible=!1}}))}))}}))},openAwardEdit(a){this.$store.state.awardEditVisible=!0,this.cid=a.row.data.id},handleSelect(a){var e=this.ctx.appContext.config.globalProperties;console.log(this.itemNameCache[a.value]),"1"==this.awardData.type?(this.awardData.couCurrType="",this.awardData.itemchinese=a.value,this.awardData.itemname=this.itemNameCache[a.value].itemname,this.awardData.itemicon=(this.itemNameCache[a.value].icon?this.itemNameCache[a.value].icon.Value:this.itemNameCache[a.value].itemname)+".png",this.awardData.itemtint=null===this.itemNameCache[a.value].tint?"1|1|1|1":this.itemNameCache[a.value].tint,e.$LoadTintImage(t("#imgDesc")[0],this.awardData.itemicon,this.awardData.itemtint),t("#imgDesc").show()):this.awardData.couCurrType=a.value},handleSelectImage(a){this.awardData.itemicon=a},querySearchAsync(a,e){if(a&&a.length>=1){let t={itemname:a,skip:"0",take:"100"};l.get("api/getSystemItemByPage",{params:t}).then((a=>{if("1"===a.data.respCode){let l=JSON.parse(a.data.data),i=[];for(var t=0;t<l.length;t++)null!=l[t].translate&&""!=l[t].translate?(i[t]={value:l[t].translate[16]},this.itemNameCache[l[t].translate[16]]=l[t]):(i[t]={value:l[t].itemname},this.itemNameCache[l[t].itemname]=l[t]);e(i)}}))}},handleAddAward(){this.awardData.id="-1",this.awardAddVisible=!0,this.$nextTick((()=>{this.handleEdtor()}))},openAddUpdate(a){this.awardAddVisible=!0,this.$nextTick((()=>{this.handleEdtor(),this.editor.txt.html(a.row.data.desc)})),this.awardData.id=a.row.data.id+"",this.awardData.type=a.row.data.type+"",this.awardData.containerid=a.row.data.containerid+"",this.awardData.count=a.row.data.count+"",this.awardData.itemname=a.row.data.itemname+"",this.awardData.itemquality=a.row.data.itemquality+"",this.awardData.itemchinese=a.row.data.itemchinese+"",this.awardData.itemicon=a.row.data.itemicon+"",this.awardData.itemtint=a.row.data.itemtint+"",this.awardData.command=a.row.data.command+"",this.awardData.couCurrType=a.row.data.couCurrType+"",this.awardData.couPrice=a.row.data.couPrice+"",this.awardData.couCond=a.row.data.couCond+"",this.awardData.coudatelimit=a.row.data.coudatelimit+"",this.awardData.couDateStart=a.row.data.couDateStart+"",this.awardData.couDateEnd=a.row.data.couDateEnd+"",this.awardData.couDate=[this.awardData.couDateStart,this.awardData.couDateEnd],this.selectspeitem=this.awardData.itemname,this.awardData.crafttime=a.row.data.crafttime},handleAddDelete(a){d.confirm("确定要删除这个商品吗？").then((e=>{if("confirm"===e){let e={id:a+""};l.post("api/deleteExchange",e).then((a=>{"1"===a.data.respCode?i({message:"删除成功!",type:"success"}):i.error("删除失败"),this.initTableData()}))}})).catch((()=>{}))},selectspecialitem(a){console.log(a);const e=o((()=>this.speitems.filter((e=>e.id===a))));e.value&&e.value[0]&&(this.awardData.itemname=e.value[0].itemname,this.awardData.itemquality=e.value[0].itemquality,this.awardData.itemchinese=e.value[0].itemchinese,this.awardData.itemicon=e.value[0].itemicon,this.awardData.itemtint=e.value[0].itemtint,this.awardData.command=e.value[0].command,this.awardData.couDate=[e.value[0].couDateStart,e.value[0].couDateEnd],this.awardData.couCurrType=e.value[0].couCurrType,this.awardData.couPrice=e.value[0].couPrice,this.awardData.couCond=e.value[0].couCond,this.awardData.coudatelimit=e.value[0].coudatelimit,this.awardData.couDateStart=e.value[0].couDateStart,this.awardData.couDateEnd=e.value[0].couDateEnd)}}},C=f();s("data-v-580277ce");const v={class:"handle-box"},V=h("添加"),k=h("编辑转换 "),_=h("编辑合成材料 "),A=h("编辑兑换物品 "),E=h("删除 "),S=u("img",{id:"imgDesc",style:{display:"none"}},null,-1),T=u("br",null,null,-1),x=u("div",{class:"container"},[u("div",{class:"plugins-tips"}," 物品描述 "),u("div",{class:"mgb20",id:"editor"})],-1),q={class:"dialog-footer"},I=h("确 定"),N=h("取 消"),U=h("重 置");r();const P=C(((a,e,t,l,i,d)=>{const o=n("el-button"),s=n("el-table-column"),r=n("el-table"),f=n("el-option"),g=n("el-select"),b=n("el-form-item"),P=n("el-input"),Y=n("el-autocomplete"),F=n("el-slider"),$=n("el-form"),z=n("el-dialog"),H=n("AawrdComponent");return c(),m("div",null,[u("div",v,[u(o,{type:"success",icon:"el-icon-plus",onClick:d.handleAddAward},{default:C((()=>[V])),_:1},8,["onClick"])]),u(r,{border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header",data:i.awardInfo},{default:C((()=>[u(s,{prop:"data.id",label:"ID",width:"55",align:"center"}),u(s,{label:"类型"},{default:C((a=>[h(w("1"==a.row.data.type?"游戏内物品制作":"2"==a.row.data.type?"游戏内物品兑换":"3"==a.row.data.type?"特殊物品制作":"4"==a.row.data.type?"特殊物品兑换":"未知"),1)])),_:1}),u(s,{label:"物品名称"},{default:C((a=>[u("span",null,w(a.row.data.itemchinese)+" 品质："+w(a.row.data.itemquality&&""!=a.row.data.itemquality?a.row.data.itemquality:"无"),1)])),_:1}),u(s,{label:"数量"},{default:C((a=>[u("span",null,w(a.row.data.count),1)])),_:1}),u(s,{label:"奖励信息"},{default:C((e=>["1"==e.row.data.type||"2"==e.row.data.type?(c(),m("img",{key:0,style:{height:"30px"},src:"404",onError:t=>a.$LoadTintImage(t.target,e.row.data.itemicon,e.row.data.itemtint)},null,40,["onError"])):p("",!0),"3"==e.row.data.type||"4"==e.row.data.type?(c(),m("img",{key:1,style:{height:"30px"},src:"api/image/"+e.row.data.itemicon},null,8,["src"])):p("",!0)])),_:1}),u(s,{label:"操作",width:"350",align:"center"},{default:C((a=>[u(o,{type:"primary",icon:"el-icon-edit",size:"small",onClick:e=>d.openAddUpdate(a)},{default:C((()=>[k])),_:2},1032,["onClick"]),"1"==a.row.data.type||"3"==a.row.data.type?(c(),m(o,{key:0,type:"primary",icon:"el-icon-edit",size:"small",onClick:e=>d.openAwardEdit(a)},{default:C((()=>[_])),_:2},1032,["onClick"])):p("",!0),"2"==a.row.data.type||"4"==a.row.data.type?(c(),m(o,{key:1,type:"primary",icon:"el-icon-edit",size:"small",onClick:e=>d.openAwardEdit(a)},{default:C((()=>[A])),_:2},1032,["onClick"])):p("",!0),u(o,{type:"delete",icon:"el-icon-delete",size:"small",class:"red",onClick:e=>d.handleAddDelete(a.row.data.id)},{default:C((()=>[E])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),u(z,{title:"新增转换",modelValue:i.awardAddVisible,"onUpdate:modelValue":e[12]||(e[12]=a=>i.awardAddVisible=a),width:"50%","append-to-body":!0,"close-on-click-modal":!1},{footer:C((()=>[u("span",q,[u(o,{type:"primary",onClick:e[9]||(e[9]=a=>d.submitAddForm("awardData"))},{default:C((()=>[I])),_:1}),u(o,{onClick:e[10]||(e[10]=a=>i.awardAddVisible=!1)},{default:C((()=>[N])),_:1}),u(o,{onClick:e[11]||(e[11]=a=>d.resetForm("awardData"))},{default:C((()=>[U])),_:1})])])),default:C((()=>[u($,{ref:"awardData",model:i.awardData},{default:C((()=>[u(b,{label:"转换类型",class:"center"},{default:C((()=>[u(g,{modelValue:i.awardData.type,"onUpdate:modelValue":e[1]||(e[1]=a=>i.awardData.type=a),placeholder:"请选择奖品类型",class:"handle-space"},{default:C((()=>[u(f,{key:"1",label:"游戏内物品制作",value:"1"}),u(f,{key:"2",label:"游戏内物品兑换",value:"2"}),u(f,{key:"3",label:"特殊物品制作",value:"3"}),u(f,{key:"4",label:"特殊物品兑换",value:"4"})])),_:1},8,["modelValue"])])),_:1}),"3"==i.awardData.type||"4"==i.awardData.type?(c(),m(D,{key:0},[u(b,{label:"预设物品",class:"center"},{default:C((()=>[u(g,{placeholder:"请选预设特殊物品",class:"handle-space",modelValue:i.selectspeitem,"onUpdate:modelValue":e[2]||(e[2]=a=>i.selectspeitem=a),onChange:d.selectspecialitem},{default:C((()=>[(c(!0),m(D,null,y(i.speitems,(a=>(c(),m(f,{key:a.id,label:a.itemchinese,value:a.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),u(b,{label:"物品数量",class:"center"},{default:C((()=>[u(P,{class:"handle-space",placeholder:"请输入物品数量",modelValue:i.awardData.count,"onUpdate:modelValue":e[3]||(e[3]=a=>i.awardData.count=a)},null,8,["modelValue"])])),_:1})],64)):p("",!0),"1"==i.awardData.type||"2"==i.awardData.type?(c(),m(D,{key:1},[u(b,{label:"物品名称",class:"center"},{default:C((()=>[u(Y,{style:{width:"70%"},minlength:2,modelValue:i.awardData.itemchinese,"onUpdate:modelValue":e[4]||(e[4]=a=>i.awardData.itemchinese=a),"fetch-suggestions":d.querySearchAsync,placeholder:"请输入内容",onSelect:d.handleSelect},null,8,["modelValue","fetch-suggestions","onSelect"])])),_:1}),u(b,{label:"系统名称",class:"center"},{default:C((()=>[u(P,{style:{width:"70%"},minlength:2,modelValue:i.awardData.itemname,"onUpdate:modelValue":e[5]||(e[5]=a=>i.awardData.itemname=a),placeholder:"请输入内容"},null,8,["modelValue"])])),_:1}),u(b,{class:"center"},{default:C((()=>[S])),_:1}),u(b,{label:"品质",class:"center"},{default:C((()=>[u(F,{modelValue:i.awardData.itemquality,"onUpdate:modelValue":e[6]||(e[6]=a=>i.awardData.itemquality=a),"show-tooltip":!0,step:1,max:6,"show-stops":"","show-input":"",marks:i.marks},null,8,["modelValue","marks"])])),_:1}),T,u(b,{label:"物品数量",class:"center"},{default:C((()=>[u(P,{class:"handle-space",placeholder:"请输入物品数量",modelValue:i.awardData.count,"onUpdate:modelValue":e[7]||(e[7]=a=>i.awardData.count=a)},null,8,["modelValue"])])),_:1}),"1"==i.awardData.type||"3"==i.awardData.type?(c(),m(b,{key:0,label:"制作时间",class:"center"},{default:C((()=>[u(P,{class:"handle-space",placeholder:"请输入制作耗时，单位秒",modelValue:i.awardData.crafttime,"onUpdate:modelValue":e[8]||(e[8]=a=>i.awardData.crafttime=a)},null,8,["modelValue"])])),_:1})):p("",!0)],64)):p("",!0),u(b,null,{default:C((()=>[x])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),u(H,{fid:i.fid,cid:i.cid},null,8,["fid","cid"])])}));b.render=P,b.__scopeId="data-v-580277ce";export default b;
