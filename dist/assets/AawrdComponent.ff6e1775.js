import{h as a}from"./moment.08a7f518.js";import{p as e,a as t,A as l,E as i,H as d,$ as o,L as s,b as r,r as n,o as c,c as m,f as u,g as h,t as w,l as p,F as D,i as y,w as f}from"./vendor.531192b1.js";const b={props:["cid","fid"],name:"AawrdComponent",data(){return{ctx:{},itemNameCache:[],speitems:{},selectspeitem:"",awardInfo:[],awardAddVisible:!1,awardData:{funcid:this.fid,id:"-1",type:"",containerid:this.cid,count:"",itemname:"",itemquality:"",itemchinese:"",itemicon:"",itemtint:"",command:"",couDate:[a().format("YYYY-MM-DD HH:mm:ss"),a().add("7","days").format("YYYY-MM-DD HH:mm:ss")],couCurrType:"",couPrice:"",couCond:"",coudatelimit:"",couDateStart:"",couDateEnd:"",chance:""},marks:{0:{style:{color:"#1989FA"},label:"无品质"},1:{style:{color:"rgb(157, 138, 106)"},label:"1品质"},2:{style:{color:"rgb(208, 129, 43)"},label:"2品质"},3:{style:{color:"rgb(163, 165, 28)"},label:"3品质"},4:{style:{color:"rgb(69, 195, 54)"},label:"4品质"},5:{style:{color:"rgb(51, 96, 207)"},label:"5品质"},6:{style:{color:"rgb(165, 44, 205)"},label:"6"}}}},mounted(){this.ctx=l(),this.initTempateSPE()},watch:{cid:{handler(a,e){a!=e&&""!=a&&(this.awardData.id="-1",this.initTableData(),this.awardData.containerid=a+"")},immediate:!0}},methods:{initTempateSPE(){i.post("api/getAwardInfo",{containerid:"0",funcid:"0"}).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.speitems=e}}))},initTableData(){let a={containerid:this.cid+"",funcid:this.fid+""};i.post("api/getAwardInfo",a).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.awardInfo=e}}))},resetForm(a){this.$refs[a].resetFields()},submitAddForm(a){this.$refs[a].validate((a=>{if(!a)return!1;{let a="";a="-1"==this.awardData.id?"api/postAwardInfo":"api/updateAwardInfo",this.awardData.itemquality=this.awardData.itemquality+"",this.awardData.couDate&&2===this.awardData.couDate.length&&(this.awardData.couDateStart=this.awardData.couDate[0],this.awardData.couDateEnd=this.awardData.couDate[1],this.awardData.couDate=""),i.post(a,this.awardData).then((a=>{"1"===a.data.respCode?d({message:"保存成功!",type:"success"}):d.error("保存出错");let e={containerid:this.cid+"",funcid:this.fid};i.post("api/getAwardInfo",e).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.awardInfo=e,this.awardAddVisible=!1}}))}))}}))},handleSelect(a){var e=this.ctx.appContext.config.globalProperties;console.log(this.itemNameCache[a.value]),"1"==this.awardData.type?(this.awardData.couCurrType="",this.awardData.itemchinese=a.value,this.awardData.itemname=this.itemNameCache[a.value].itemname,this.awardData.itemicon=(this.itemNameCache[a.value].icon?this.itemNameCache[a.value].icon.Value:this.itemNameCache[a.value].itemname)+".png",this.awardData.itemtint=null===this.itemNameCache[a.value].tint?"1|1|1|1":this.itemNameCache[a.value].tint,e.$LoadTintImage(o("#imgDesc")[0],this.awardData.itemicon,this.awardData.itemtint),o("#imgDesc").show()):this.awardData.couCurrType=a.value},handleSelectImage(a){this.awardData.itemicon=a},querySearchAsync(a,e){if(a&&a.length>=1){let t={itemname:a,skip:"0",take:"100"};i.get("api/getSystemItemByPage",{params:t}).then((a=>{if("1"===a.data.respCode){let l=JSON.parse(a.data.data),i=[];for(var t=0;t<l.length;t++)null!=l[t].translate&&""!=l[t].translate?(i[t]={value:l[t].translate[16]},this.itemNameCache[l[t].translate[16]]=l[t]):(i[t]={value:l[t].itemname},this.itemNameCache[l[t].itemname]=l[t]);e(i)}}))}},handleAddAward(){this.awardData.id="-1",this.awardAddVisible=!0},openAddUpdate(a){this.awardAddVisible=!0,this.awardData.id=a.row.id+"",this.awardData.type=a.row.type+"",this.awardData.containerid=a.row.containerid+"",this.awardData.count=a.row.count+"",this.awardData.itemname=a.row.itemname+"",this.awardData.itemquality=a.row.itemquality+"",this.awardData.itemchinese=a.row.itemchinese+"",this.awardData.itemicon=a.row.itemicon+"",this.awardData.itemtint=a.row.itemtint+"",this.awardData.command=a.row.command+"",this.awardData.couCurrType=a.row.couCurrType+"",this.awardData.couPrice=a.row.couPrice+"",this.awardData.couCond=a.row.couCond+"",this.awardData.coudatelimit=a.row.coudatelimit+"",this.awardData.couDateStart=a.row.couDateStart+"",this.awardData.couDateEnd=a.row.couDateEnd+"",this.awardData.couDate=[this.awardData.couDateStart,this.awardData.couDateEnd],this.selectspeitem=this.awardData.itemname,this.awardData.chance=a.row.chance+""},handleAddDelete(a){s.confirm("确定要删除这个商品吗？").then((e=>{if("confirm"===e){let e={id:a+""};i.post("api/deleteAwardInfo",e).then((a=>{"1"===a.data.respCode?d({message:"删除成功!",type:"success"}):d.error("删除失败");let e={containerid:this.cid+"",funcid:this.fid};i.post("api/getAwardInfo",e).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.awardInfo=e,this.awardAddVisible=!1}}))}))}})).catch((()=>{}))},selectspecialitem(a){console.log(a);const e=r((()=>this.speitems.filter((e=>e.id===a))));e.value&&e.value[0]&&(this.awardData.itemname=e.value[0].itemname,this.awardData.itemquality=e.value[0].itemquality,this.awardData.itemchinese=e.value[0].itemchinese,this.awardData.itemicon=e.value[0].itemicon,this.awardData.itemtint=e.value[0].itemtint,this.awardData.command=e.value[0].command,this.awardData.couDate=[e.value[0].couDateStart,e.value[0].couDateEnd],this.awardData.couCurrType=e.value[0].couCurrType,this.awardData.couPrice=e.value[0].couPrice,this.awardData.couCond=e.value[0].couCond,this.awardData.coudatelimit=e.value[0].coudatelimit,this.awardData.couDateStart=e.value[0].couDateStart,this.awardData.couDateEnd=e.value[0].couDateEnd)}}},g=f();e("data-v-32d2d4ac");const V={class:"handle-box"},k=h("搜索"),C=h("添加"),v={key:0},_={key:1},A={key:2},S={key:3},I={key:4},E={key:0},U={key:1},q={key:2},T={key:3},x={key:4},N={key:2},P=h("编辑 "),Y=h("删除 "),F=u("img",{id:"imgDesc",style:{display:"none"}},null,-1),$=u("br",null,null,-1),H={class:"dialog-footer"},M=h("确 定"),j=h("取 消"),z=h("重 置");t();const L=g(((a,e,t,l,i,d)=>{const o=n("el-input"),s=n("el-button"),r=n("el-table-column"),f=n("el-table"),b=n("el-dialog"),L=n("el-option"),B=n("el-select"),J=n("el-form-item"),O=n("el-autocomplete"),G=n("el-slider"),K=n("el-form");return c(),m("div",null,[u(b,{title:"奖品编辑",modelValue:a.$store.state.awardEditVisible,"onUpdate:modelValue":e[2]||(e[2]=e=>a.$store.state.awardEditVisible=e),width:"80%","append-to-body":!0,"close-on-click-modal":!1},{default:g((()=>[u("div",V,[u(o,{placeholder:"名称",class:"handle-input mr10"}),u(s,{type:"primary",icon:"el-icon-search",onClick:e[1]||(e[1]=()=>{})},{default:g((()=>[k])),_:1}),u(s,{type:"success",icon:"el-icon-plus",onClick:d.handleAddAward},{default:g((()=>[C])),_:1},8,["onClick"])]),u(f,{border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header",data:i.awardInfo},{default:g((()=>[u(r,{prop:"id",label:"ID",width:"55",align:"center"}),u(r,{label:"物品类型"},{default:g((a=>[h(w("1"==a.row.type?"游戏内物品":"2"==a.row.type?"特殊物品":"3"==a.row.type?"指令":"4"==a.row.type?"积分":"5"==a.row.type?"点券":"未知"),1)])),_:1}),u(r,{label:"物品名称"},{default:g((a=>["1"==a.row.type?(c(),m("span",v,w(a.row.itemchinese)+" 品质："+w(a.row.itemquality&&""!=a.row.itemquality?a.row.itemquality:"无"),1)):p("",!0),"2"==a.row.type?(c(),m("span",_,w(a.row.itemchinese),1)):p("",!0),"3"==a.row.type?(c(),m("span",A,"指令")):p("",!0),"4"==a.row.type?(c(),m("span",S,"积分")):p("",!0),"5"==a.row.type?(c(),m("span",I,"点券")):p("",!0)])),_:1}),u(r,{label:"数量"},{default:g((a=>["1"==a.row.type?(c(),m("span",E,w(a.row.count),1)):p("",!0),"2"==a.row.type?(c(),m("span",U,w(a.row.count),1)):p("",!0),"3"==a.row.type?(c(),m("span",q,"无")):p("",!0),"4"==a.row.type?(c(),m("span",T,w(a.row.count),1)):p("",!0),"5"==a.row.type?(c(),m("span",x,w(a.row.count),1)):p("",!0)])),_:1}),u(r,{label:"奖励信息"},{default:g((e=>["1"==e.row.type?(c(),m("img",{key:0,style:{height:"30px"},src:"404",onError:t=>a.$LoadTintImage(t.target,e.row.itemicon,e.row.itemtint)},null,40,["onError"])):p("",!0),"2"==e.row.type?(c(),m("img",{key:1,style:{height:"30px"},src:"api/image/"+e.row.itemicon},null,8,["src"])):p("",!0),"3"==e.row.type?(c(),m("span",N,w(e.row.command),1)):p("",!0),"5"==e.row.type?(c(),m("img",{key:3,style:{height:"30px"},src:"images/items/red-zs.png"},null,8,["src"])):p("",!0),"4"==e.row.type?(c(),m("img",{key:4,style:{height:"30px"},src:"images/items/jf2.png"},null,8,["src"])):p("",!0)])),_:1}),u(r,{label:"操作",width:"350",align:"center"},{default:g((a=>[u(s,{type:"primary",icon:"el-icon-edit",size:"small",onClick:e=>d.openAddUpdate(a)},{default:g((()=>[P])),_:2},1032,["onClick"]),u(s,{type:"delete",icon:"el-icon-delete",size:"small",class:"red",onClick:e=>d.handleAddDelete(a.row.id)},{default:g((()=>[Y])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"]),u(b,{title:"新增奖品",modelValue:i.awardAddVisible,"onUpdate:modelValue":e[17]||(e[17]=a=>i.awardAddVisible=a),width:"50%","append-to-body":!0,"close-on-click-modal":!1},{footer:g((()=>[u("span",H,[u(s,{type:"primary",onClick:e[14]||(e[14]=a=>d.submitAddForm("awardData"))},{default:g((()=>[M])),_:1}),u(s,{onClick:e[15]||(e[15]=a=>i.awardAddVisible=!1)},{default:g((()=>[j])),_:1}),u(s,{onClick:e[16]||(e[16]=a=>d.resetForm("awardData"))},{default:g((()=>[z])),_:1})])])),default:g((()=>[u(K,{ref:"awardData",model:i.awardData},{default:g((()=>[u(J,{label:"奖品类型",class:"center"},{default:g((()=>[u(B,{modelValue:i.awardData.type,"onUpdate:modelValue":e[3]||(e[3]=a=>i.awardData.type=a),placeholder:"请选择奖品类型",class:"handle-space"},{default:g((()=>[u(L,{key:"1",label:"游戏内物品",value:"1"}),u(L,{key:"2",label:"特殊物品",value:"2"}),u(L,{key:"3",label:"指令",value:"3"}),u(L,{key:"4",label:"积分",value:"4"}),u(L,{key:"5",label:"点券",value:"5"})])),_:1},8,["modelValue"])])),_:1}),"5"==i.awardData.type?(c(),m(J,{key:0,label:"点券数量",class:"center"},{default:g((()=>[u(o,{class:"handle-space",placeholder:"请输入点券数量",modelValue:i.awardData.count,"onUpdate:modelValue":e[4]||(e[4]=a=>i.awardData.count=a)},null,8,["modelValue"])])),_:1})):p("",!0),"4"==i.awardData.type?(c(),m(J,{key:1,label:"积分数量",class:"center"},{default:g((()=>[u(o,{class:"handle-space",placeholder:"请输入积分数量",modelValue:i.awardData.count,"onUpdate:modelValue":e[5]||(e[5]=a=>i.awardData.count=a)},null,8,["modelValue"])])),_:1})):p("",!0),"3"==i.awardData.type?(c(),m(J,{key:2,label:"指令",class:"center"},{default:g((()=>[u(o,{class:"handle-space",placeholder:"请输入指令，{name}可代表用户名，{id}可代表id",modelValue:i.awardData.command,"onUpdate:modelValue":e[6]||(e[6]=a=>i.awardData.command=a)},null,8,["modelValue"])])),_:1})):p("",!0),"2"==i.awardData.type?(c(),m(D,{key:3},[u(J,{label:"预设物品",class:"center"},{default:g((()=>[u(B,{placeholder:"请选预设特殊物品",class:"handle-space",modelValue:i.selectspeitem,"onUpdate:modelValue":e[7]||(e[7]=a=>i.selectspeitem=a),onChange:d.selectspecialitem},{default:g((()=>[(c(!0),m(D,null,y(i.speitems,(a=>(c(),m(L,{key:a.id,label:a.itemchinese,value:a.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),u(J,{label:"物品数量",class:"center"},{default:g((()=>[u(o,{class:"handle-space",placeholder:"请输入物品数量",modelValue:i.awardData.count,"onUpdate:modelValue":e[8]||(e[8]=a=>i.awardData.count=a)},null,8,["modelValue"])])),_:1})],64)):p("",!0),"1"==i.awardData.type?(c(),m(D,{key:4},[u(J,{label:"物品名称",class:"center"},{default:g((()=>[u(O,{style:{width:"70%"},minlength:2,modelValue:i.awardData.itemchinese,"onUpdate:modelValue":e[9]||(e[9]=a=>i.awardData.itemchinese=a),"fetch-suggestions":d.querySearchAsync,placeholder:"请输入内容",onSelect:d.handleSelect},null,8,["modelValue","fetch-suggestions","onSelect"])])),_:1}),u(J,{label:"系统名称",class:"center"},{default:g((()=>[u(o,{style:{width:"70%"},minlength:2,modelValue:i.awardData.itemname,"onUpdate:modelValue":e[10]||(e[10]=a=>i.awardData.itemname=a),placeholder:"请输入内容"},null,8,["modelValue"])])),_:1}),u(J,{class:"center"},{default:g((()=>[F])),_:1}),u(J,{label:"品质",class:"center"},{default:g((()=>[u(G,{modelValue:i.awardData.itemquality,"onUpdate:modelValue":e[11]||(e[11]=a=>i.awardData.itemquality=a),"show-tooltip":!0,step:1,max:6,"show-stops":"","show-input":"",marks:i.marks},null,8,["modelValue","marks"])])),_:1}),$,u(J,{label:"物品数量",class:"center"},{default:g((()=>[u(o,{class:"handle-space",placeholder:"请输入物品数量",modelValue:i.awardData.count,"onUpdate:modelValue":e[12]||(e[12]=a=>i.awardData.count=a)},null,8,["modelValue"])])),_:1})],64)):p("",!0),"3"==t.fid?(c(),m(J,{key:5,label:"中奖权重",class:"center"},{default:g((()=>[u(o,{class:"handle-space",placeholder:"请输入权重，值越大中奖概率越高",modelValue:i.awardData.chance,"onUpdate:modelValue":e[13]||(e[13]=a=>i.awardData.chance=a)},null,8,["modelValue"])])),_:1})):p("",!0)])),_:1},8,["model"])])),_:1},8,["modelValue"])])}));b.render=L,b.__scopeId="data-v-32d2d4ac";export{b as _};
