import{A as a,E as e,G as t,$ as l,L as i,r as d,o as r,c as s,f as o,k as n,g as c,t as u,l as m,F as h,i as p,C as w,D}from"./vendor.40f5b264.js";import{h as f}from"./moment.08a7f518.js";const y={name:"ShopManage",mounted(){this.ctx=a(),this.initTableData(),this.initIconData()},data:()=>({isDisabled:!1,awardEditVisible:!1,awardAddVisible:!1,customData:0,md1:"md1",imglist:null,allIcon:[],queryData:null,awardInfo:null,allChanceCount:0,rules:{itemType:[{required:!0,trigger:"blur",message:"请选择物品类型"}]},awardData:{specialtype:"",funcid:"0",id:"-1",type:"2",containerid:"0",count:"0",itemname:"",itemquality:"",itemchinese:"",itemicon:"",itemtint:"",command:"",couDate:[f().format("YYYY-MM-DD HH:mm:ss"),f().add("7","days").format("YYYY-MM-DD HH:mm:ss")],couCurrType:"",couPrice:"",couCond:"",coudatelimit:"",couDateStart:"",couDateEnd:"",chance:""},instance:!1,editor:"",ctx:{},addVisible:!1,itemNameCache:[],marks:{0:{style:{color:"#1989FA"},label:"无品质"},1:{style:{color:"rgb(157, 138, 106)"},label:"1品质"},2:{style:{color:"rgb(208, 129, 43)"},label:"2品质"},3:{style:{color:"rgb(163, 165, 28)"},label:"3品质"},4:{style:{color:"rgb(69, 195, 54)"},label:"4品质"},5:{style:{color:"rgb(51, 96, 207)"},label:"5品质"},6:{style:{color:"rgb(165, 44, 205)"},label:"6"}}}),methods:{speChange(){console.log(this.awardData.specialtype);var a="";"1"==this.awardData.specialtype&&(a+="积分折扣",a+=Math.round(8999*Math.random())+1e3,this.awardData.itemname=a,this.awardData.itemchinese=a,this.awardData.couCurrType=a),"2"==this.awardData.specialtype&&(a+="积分满减",a+=Math.round(8999*Math.random())+1e3,this.awardData.itemname=a,this.awardData.itemchinese=a,this.awardData.couCurrType=a),"3"==this.awardData.specialtype&&(a+="钻石折扣",a+=Math.round(8999*Math.random())+1e3,this.awardData.itemname=a,this.awardData.itemchinese=a,this.awardData.couCurrType=a),"4"==this.awardData.specialtype&&(a+="钻石满减",a+=Math.round(8999*Math.random())+1e3,this.awardData.itemname=a,this.awardData.itemchinese=a,this.awardData.couCurrType=a),"5"==this.awardData.specialtype&&(this.awardData.itemname="",this.awardData.itemchinese="",this.awardData.couCurrType="")},querySearchAsync(a,t){if(a&&a.length>=1){let l={itemname:a,skip:"0",take:"100"};e.get("api/getSystemItemByPage",{params:l}).then((a=>{if("1"===a.data.respCode){let l=JSON.parse(a.data.data),i=[];for(var e=0;e<l.length;e++)null!=l[e].translate&&""!=l[e].translate?(i[e]={value:l[e].translate[16]},this.itemNameCache[l[e].translate[16]]=l[e]):(i[e]={value:l[e].itemname},this.itemNameCache[l[e].itemname]=l[e]);t(i)}}))}},handleSelectImage(a){this.awardData.itemicon=a},handleSelectImageLottery(a){this.formData.itemicon=a},handleAvatarSuccess(){t({message:"上传成功!",type:"success"}),this.initIconData()},handleAvatarFaild(){t.error("上传失败"),this.initIconData()},initIconData(){e.post("api/getIconFile",{itemname:""}).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.allIcon=e}}))},handleSelect(a){var e=this.ctx.appContext.config.globalProperties;console.log(this.itemNameCache[a.value]),"1"==this.awardData.type?(this.awardData.couCurrType="",this.awardData.itemchinese=a.value,this.awardData.itemname=this.itemNameCache[a.value].itemname,this.awardData.itemicon=(this.itemNameCache[a.value].icon?this.itemNameCache[a.value].icon.Value:this.itemNameCache[a.value].itemname)+".png",this.awardData.itemtint=null===this.itemNameCache[a.value].tint?"1|1|1|1":this.itemNameCache[a.value].tint,e.$LoadTintImage(l("#imgDesc")[0],this.awardData.itemicon,this.awardData.itemtint),l("#imgDesc").show()):this.awardData.couCurrType=a.value},handleSelectLottery(a){var e=this.ctx.appContext.config.globalProperties;console.log(this.itemNameCache[a.value]),"3"==this.formData.type&&(this.formData.itemchinese=a.value,this.formData.itemname=this.itemNameCache[a.value].itemname,this.formData.itemicon=(this.itemNameCache[a.value].icon?this.itemNameCache[a.value].icon.Value:this.itemNameCache[a.value].itemname)+".png",this.formData.itemtint=null===this.itemNameCache[a.value].tint?"1|1|1|1":this.itemNameCache[a.value].tint,e.$LoadTintImage(l(".imgDesc")[0],this.formData.itemicon,this.formData.itemtint),l(".imgDesc").show())},handleAddDelete(a){i.confirm("确定要删除这个商品吗？").then((l=>{if("confirm"===l){let l={id:a+""};e.post("api/deleteAwardInfo",l).then((a=>{"1"===a.data.respCode?t({message:"删除成功!",type:"success"}):t.error("删除失败");e.post("api/getAwardInfo",{containerid:"0",funcid:"0"}).then((a=>{if("1"===a.data.respCode){let t=a.data.data;for(var e in this.awardInfo=t,this.awardAddVisible=!1,this.awardInfo)this.allChanceCount+=1*this.awardInfo[e].chance;console.log(this.allChanceCount)}}))}))}})).catch((()=>{}))},initTableData(){e.post("api/getAwardInfo",{containerid:"0",funcid:"0"}).then((a=>{if("1"===a.data.respCode){let t=a.data.data;for(var e in this.awardInfo=t,this.awardInfo)this.allChanceCount+=1*this.awardInfo[e].chance;console.log(this.allChanceCount)}}))},submitAddForm(a){this.$refs[a].validate((a=>{if(!a)return!1;{let a="";a="-1"==this.awardData.id?"api/postAwardInfo":"api/updateAwardInfo",this.awardData.itemquality=this.awardData.itemquality+"",this.awardData.couDate&&2===this.awardData.couDate.length&&(this.awardData.couDateStart=this.awardData.couDate[0],this.awardData.couDateEnd=this.awardData.couDate[1],this.awardData.couDate=""),e.post(a,this.awardData).then((a=>{"1"===a.data.respCode?t({message:"保存成功!",type:"success"}):t.error("保存出错");e.post("api/getAwardInfo",{containerid:"0",funcid:"0"}).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.awardInfo=e,this.awardAddVisible=!1}}))}))}}))},openAddUpdate(a){this.awardAddVisible=!0,this.awardData.id=a.row.id+"",this.awardData.type=a.row.type+"",this.awardData.containerid=a.row.containerid+"",this.awardData.count=a.row.count+"",this.awardData.itemname=a.row.itemname+"",this.awardData.itemquality=a.row.itemquality+"",this.awardData.itemchinese=a.row.itemchinese+"",this.awardData.itemicon=a.row.itemicon+"",this.awardData.itemtint=a.row.itemtint+"",this.awardData.command=a.row.command+"",this.awardData.couCurrType=a.row.couCurrType+"",this.awardData.couPrice=a.row.couPrice+"",this.awardData.couCond=a.row.couCond+"",this.awardData.coudatelimit=a.row.coudatelimit+"",this.awardData.couDateStart=a.row.couDateStart+"",this.awardData.couDateEnd=a.row.couDateEnd+"",this.awardData.couDate=[this.awardData.couDateStart,this.awardData.couDateEnd],this.awardData.itemname.indexOf("积分折扣")>=0?this.awardData.specialtype="1":this.awardData.itemname.indexOf("积分满减")>=0?this.awardData.specialtype="2":this.awardData.itemname.indexOf("钻石折扣")>=0?this.awardData.specialtype="3":this.awardData.itemname.indexOf("钻石满减")>=0?this.awardData.specialtype="4":this.awardData.specialtype="5"},openAwardEdit(a){this.initIconData(),this.awardEditVisible=!0;this.awardData.containerid=a.row.id+"",e.post("api/getAwardInfo",{containerid:"0",funcid:"0"}).then((a=>{if("1"===a.data.respCode){let t=a.data.data;for(var e in this.awardInfo=t,this.awardInfo)this.allChanceCount+=1*this.awardInfo[e].chance;console.log(this.allChanceCount)}}))},resetForm(a){this.$refs[a].resetFields()},discountchange(){this.formData.prefer=(parseInt(this.formData.price)*(this.formData.discount/10)).toFixed(2)+""},preferchange(){parseInt(this.formData.prefer)>parseInt(this.formData.price)&&(this.formData.price=this.formData.prefer,this.formData.discount=10),this.formData.discount=(parseInt(this.formData.prefer)/parseInt(this.formData.price)*10).toFixed(2)},catchs(a){},handleAddAward(){this.awardData.id="-1",this.awardAddVisible=!0},loadCouCurr(a,e){e([{value:"积分折扣"},{value:"积分满减"},{value:"钻石折扣"},{value:"钻石满减"}])}}},C={class:"crumbs"},g=o("i",{class:"el-icon-lx-cascades"},null,-1),b=c(" 基础表格 "),V={class:"container"},v={class:"handle-box"},k=c("添加"),_={key:0},I={key:1},A={key:2},x={key:3},T={key:4},S={key:0},N={key:1},U={key:2},q={key:3},F={key:4},M={key:1},O=c("编辑 "),P=c("删除 "),E={class:"infinite-list",style:{"overflow-x":"scroll"}},Y=c("添加新图片"),L=o("img",{id:"imgDesc",style:{display:"none"}},null,-1),H=c("满"),$=c("减"),j=c("满"),z=c("折"),B={class:"dialog-footer"},G=c("确 定"),J=c("取 消"),K=c("重 置");y.render=function(a,e,t,l,i,f){const y=d("el-breadcrumb-item"),Q=d("el-breadcrumb"),R=d("el-button"),W=d("el-table-column"),X=d("el-table"),Z=d("el-option"),aa=d("el-select"),ea=d("el-form-item"),ta=d("el-input"),la=d("el-tag"),ia=d("el-upload"),da=d("el-image"),ra=d("el-autocomplete"),sa=d("el-slider"),oa=d("el-col"),na=d("el-row"),ca=d("el-date-picker"),ua=d("el-form"),ma=d("el-dialog");return r(),s("div",null,[o("div",C,[o(Q,{separator:"/"},{default:n((()=>[o(y,null,{default:n((()=>[g,b])),_:1})])),_:1})]),o("div",V,[o("div",v,[o(R,{type:"success",icon:"el-icon-plus",onClick:f.handleAddAward},{default:n((()=>[k])),_:1},8,["onClick"])]),o(X,{border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header",data:i.awardInfo},{default:n((()=>[o(W,{prop:"id",label:"ID",width:"55",align:"center"}),o(W,{label:"物品类型"},{default:n((a=>[c(u("1"==a.row.type?"游戏内物品":"2"==a.row.type?"特殊物品":"3"==a.row.type?"指令":"4"==a.row.type?"积分":"5"==a.row.type?"点券":"未知"),1)])),_:1}),o(W,{label:"物品名称"},{default:n((a=>["1"==a.row.type?(r(),s("span",_,u(a.row.itemchinese)+" 品质："+u(a.row.itemquality&&""!=a.row.itemquality?a.row.itemquality:"无"),1)):m("",!0),"2"==a.row.type?(r(),s("span",I,u(a.row.itemchinese),1)):m("",!0),"3"==a.row.type?(r(),s("span",A,"指令")):m("",!0),"4"==a.row.type?(r(),s("span",x,"积分")):m("",!0),"5"==a.row.type?(r(),s("span",T,"点券")):m("",!0)])),_:1}),o(W,{label:"数量"},{default:n((a=>["1"==a.row.type?(r(),s("span",S,u(a.row.count),1)):m("",!0),"2"==a.row.type?(r(),s("span",N,u(a.row.count),1)):m("",!0),"3"==a.row.type?(r(),s("span",U,"无")):m("",!0),"4"==a.row.type?(r(),s("span",q,u(a.row.count),1)):m("",!0),"5"==a.row.type?(r(),s("span",F,u(a.row.count),1)):m("",!0)])),_:1}),o(W,{label:"奖励图片"},{default:n((a=>[""!=a.row.itemicon?(r(),s("img",{key:0,style:{height:"30px"},src:"api/image/"+a.row.itemicon},null,8,["src"])):m("",!0),""==a.row.itemicon?(r(),s("span",M,"未选择")):m("",!0)])),_:1}),o(W,{label:"操作",width:"350",align:"center"},{default:n((a=>[o(R,{type:"primary",icon:"el-icon-edit",size:"small",onClick:e=>f.openAddUpdate(a)},{default:n((()=>[O])),_:2},1032,["onClick"]),o(R,{type:"delete",icon:"el-icon-delete",size:"small",class:"red",onClick:e=>f.handleAddDelete(a.row.id)},{default:n((()=>[P])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),o(ma,{title:"新增奖品",modelValue:i.awardAddVisible,"onUpdate:modelValue":e[17]||(e[17]=a=>i.awardAddVisible=a),width:"50%","append-to-body":!0,"close-on-click-modal":!1},{footer:n((()=>[o("span",B,[o(R,{type:"primary",onClick:e[14]||(e[14]=a=>f.submitAddForm("awardData"))},{default:n((()=>[G])),_:1}),o(R,{onClick:e[15]||(e[15]=a=>i.awardAddVisible=!1)},{default:n((()=>[J])),_:1}),o(R,{onClick:e[16]||(e[16]=a=>f.resetForm("awardData"))},{default:n((()=>[K])),_:1})])])),default:n((()=>[o(ua,{ref:"awardData",model:i.awardData},{default:n((()=>[o(ea,{label:"奖品类型",class:"center"},{default:n((()=>[o(aa,{modelValue:i.awardData.specialtype,"onUpdate:modelValue":e[1]||(e[1]=a=>i.awardData.specialtype=a),placeholder:"请选择特殊物品类型",class:"handle-space",onChange:f.speChange},{default:n((()=>[o(Z,{key:"1",label:"积分折扣",value:"1"}),o(Z,{key:"2",label:"积分满减",value:"2"}),o(Z,{key:"3",label:"钻石折扣",value:"3"}),o(Z,{key:"4",label:"钻石满减",value:"4"}),o(Z,{key:"5",label:"自定义特殊物品",value:"5"})])),_:1},8,["modelValue","onChange"])])),_:1}),"2"==i.awardData.type?(r(),s(h,{key:0},[o(ea,{label:"物品名称",class:"center"},{default:n((()=>[o(ta,{class:"handle-space",placeholder:"请输入物品名称",modelValue:i.awardData.itemname,"onUpdate:modelValue":e[2]||(e[2]=a=>i.awardData.itemname=a),onInput:e[3]||(e[3]=a=>{i.awardData.itemchinese=a,i.awardData.itemname=a})},null,8,["modelValue"])])),_:1}),o(ea,{class:"center"},{default:n((()=>[o("ul",E,[o(ia,{action:"api/uploadFile",multiple:"","on-success":f.handleAvatarSuccess,"on-error":f.handleAvatarFaild,style:{float:"left",width:"100px",height:"100px"}},{default:n((()=>[o(la,{style:{"margin-top":"35px"}},{default:n((()=>[Y])),_:1})])),_:1},8,["on-success","on-error"]),(r(!0),s(h,null,p(i.allIcon,(a=>(r(),s("li",{key:a,class:"infinite-list-item",ref:i.imglist},[o(da,{class:{selected:a===i.awardData.itemicon},style:{width:"100px",height:"100px",cursor:"pointer"},src:"api/image/"+a,onClick:e=>f.handleSelectImage(a)},null,8,["class","src","onClick"])],512)))),128))])])),_:1})],64)):m("",!0),"1"==i.awardData.type?(r(),s(h,{key:1},[o(ea,{label:"物品名称",class:"center"},{default:n((()=>[o(ra,{style:{width:"70%"},minlength:2,modelValue:i.awardData.itemchinese,"onUpdate:modelValue":e[4]||(e[4]=a=>i.awardData.itemchinese=a),"fetch-suggestions":f.querySearchAsync,placeholder:"请输入内容",onSelect:f.handleSelect},null,8,["modelValue","fetch-suggestions","onSelect"])])),_:1}),o(ea,{label:"系统名称",class:"center"},{default:n((()=>[o(ta,{style:{width:"70%"},minlength:2,modelValue:i.awardData.itemname,"onUpdate:modelValue":e[5]||(e[5]=a=>i.awardData.itemname=a),placeholder:"请输入内容"},null,8,["modelValue"])])),_:1}),o(ea,{class:"center"},{default:n((()=>[L])),_:1}),o(ea,{label:"品质",class:"center"},{default:n((()=>[o(sa,{modelValue:i.awardData.itemquality,"onUpdate:modelValue":e[6]||(e[6]=a=>i.awardData.itemquality=a),"show-tooltip":!0,step:1,max:6,"show-stops":"","show-input":"",marks:i.marks},null,8,["modelValue","marks"])])),_:1})],64)):m("",!0),i.awardData.couCurrType.indexOf("积分折扣")>=0||i.awardData.couCurrType.indexOf("钻石折扣")>=0||i.awardData.couCurrType.indexOf("积分满减")>=0||i.awardData.couCurrType.indexOf("钻石满减")>=0?(r(),s(h,{key:2},[w(o(ea,{label:"优惠券类型",class:"center"},{default:n((()=>[o(ta,{class:"handle-space",modelValue:i.awardData.couCurrType,"onUpdate:modelValue":e[7]||(e[7]=a=>i.awardData.couCurrType=a),disabled:!0},null,8,["modelValue"])])),_:1},512),[[D,"2"===i.awardData.type]]),i.awardData.couCurrType.indexOf("积分满减")>=0||i.awardData.couCurrType.indexOf("钻石满减")>=0?w((r(),s(ea,{key:0,label:"优惠类型",class:"center"},{default:n((()=>[o(na,null,{default:n((()=>[o(oa,{span:6},{default:n((()=>[H])),_:1}),o(oa,{span:6},{default:n((()=>[o(ta,{class:"handle-space",placeholder:"请输入使用条件，0表示无限制",modelValue:i.awardData.couCond,"onUpdate:modelValue":e[8]||(e[8]=a=>i.awardData.couCond=a)},null,8,["modelValue"])])),_:1}),o(oa,{span:6},{default:n((()=>[$])),_:1}),o(oa,{span:6},{default:n((()=>[o(ta,{class:"handle-space",modelValue:i.awardData.couPrice,"onUpdate:modelValue":e[9]||(e[9]=a=>i.awardData.couPrice=a)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},512)),[[D,"2"===i.awardData.type]]):m("",!0),i.awardData.couCurrType.indexOf("积分折扣")>=0||i.awardData.couCurrType.indexOf("钻石折扣")>=0?w((r(),s(ea,{key:1,label:"优惠类型",class:"center"},{default:n((()=>[o(na,null,{default:n((()=>[o(oa,{span:6},{default:n((()=>[j])),_:1}),o(oa,{span:6},{default:n((()=>[o(ta,{class:"handle-space",placeholder:"请输入使用条件，0表示无限制",modelValue:i.awardData.couCond,"onUpdate:modelValue":e[10]||(e[10]=a=>i.awardData.couCond=a)},null,8,["modelValue"])])),_:1}),o(oa,{span:6},{default:n((()=>[o(ta,{class:"handle-space",modelValue:i.awardData.couPrice,"onUpdate:modelValue":e[11]||(e[11]=a=>i.awardData.couPrice=a)},null,8,["modelValue"])])),_:1}),o(oa,{span:6},{default:n((()=>[z])),_:1})])),_:1})])),_:1},512)),[[D,"2"===i.awardData.type]]):m("",!0),"2"===i.awardData.type?(r(),s(ea,{key:2,label:"使用限制日期",class:"center"},{default:n((()=>[o(na,null,{default:n((()=>[o(oa,{span:8},{default:n((()=>[o(aa,{modelValue:i.awardData.coudatelimit,"onUpdate:modelValue":e[12]||(e[12]=a=>i.awardData.coudatelimit=a),placeholder:"限时使用",class:"handle-space"},{default:n((()=>[o(Z,{key:"1",label:"不限时",value:"1"}),o(Z,{key:"2",label:"限时使用",value:"2"})])),_:1},8,["modelValue"])])),_:1}),o(oa,{span:15,style:{"text-align":"left","margin-right":"20px"}},{default:n((()=>[w(o("div",null,[o(ca,{modelValue:i.awardData.couDate,"onUpdate:modelValue":e[13]||(e[13]=a=>i.awardData.couDate=a),type:"datetimerange","range-separator":"至","start-placeholder":"开抢时间","end-placeholder":"结束时间",onChange:f.catchs},null,8,["modelValue","onChange"])],512),[[D,"2"===i.awardData.coudatelimit]])])),_:1})])),_:1})])),_:1})):m("",!0)],64)):m("",!0)])),_:1},8,["model"])])),_:1},8,["modelValue"])])};export default y;
