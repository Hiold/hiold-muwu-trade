import{A as a,$ as e,E as t,G as i,L as l,r as o,o as s,c as r,f as d,k as n,g as m,t as c,l as u,F as h,i as p}from"./vendor.40f5b264.js";import"./moment.08a7f518.js";import{_ as f}from"./AawrdComponent.6b1ab221.js";const D={name:"ShopManage",components:{AawrdComponent:f},mounted(){this.ctx=a(),this.initTableData(),this.initIconData()},data:()=>({fid:"4",cid:"",isDayDisable:!1,isDisabled:!1,awardEditVisible:!1,awardAddVisible:!1,customData:0,md1:"md1",imglist:null,allIcon:[],queryData:null,awardInfo:null,rules:{itemType:[{required:!0,trigger:"blur",message:"请选择物品类型"}]},formData:{id:"-1",date:"",day:"",type:"",itemname:"",itemicon:"",itemtint:"",itemchinese:"",quality:"",count:""},instance:!1,editor:"",ctx:{},addVisible:!1,itemNameCache:[]}),methods:{handleSignDate(a){var e="";if(0==a.row.day&&(e="周日"),1==a.row.day&&(e="周一"),2==a.row.day&&(e="周二"),3==a.row.day&&(e="周三"),4==a.row.day&&(e="周四"),5==a.row.day&&(e="周五"),6==a.row.day&&(e="周六"),null==a.row.date||a.row.date.startsWith("0"))return"每"+e;var t=new Date(a.row.date);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+e},handleSelectImageLottery(a){this.formData.itemicon=a},handleSelectLottery(a){var t=this.ctx.appContext.config.globalProperties;console.log(this.itemNameCache[a.value]),"3"==this.formData.type&&(this.formData.itemchinese=a.value,this.formData.itemname=this.itemNameCache[a.value].itemname,this.formData.itemicon=(this.itemNameCache[a.value].icon?this.itemNameCache[a.value].icon.Value:this.itemNameCache[a.value].itemname)+".png",this.formData.itemtint=null===this.itemNameCache[a.value].tint?"1|1|1|1":this.itemNameCache[a.value].tint,t.$LoadTintImage(e(".imgDesc")[0],this.formData.itemicon,this.formData.itemtint),e(".imgDesc").show())},changeDate(){if(""===this.formData.date||null===this.formData.date)this.isDayDisable=!1;else{this.isDayDisable=!0;var a=new Date(this.formData.date);this.formData.day=a.getDay()+""}},querySearchAsync(a,e){if(a&&a.length>=1){let i={itemname:a,skip:"0",take:"100"};t.get("api/getSystemItemByPage",{params:i}).then((a=>{if("1"===a.data.respCode){let i=JSON.parse(a.data.data),l=[];for(var t=0;t<i.length;t++)null!=i[t].translate&&""!=i[t].translate?(l[t]={value:i[t].translate[16]},this.itemNameCache[i[t].translate[16]]=i[t]):(l[t]={value:i[t].itemname},this.itemNameCache[i[t].itemname]=i[t]);e(l)}}))}},handleSelectImage(a){this.awardData.itemicon=a},handleAvatarSuccess(){i({message:"上传成功!",type:"success"}),this.initIconData()},handleAvatarFaild(){i.error("上传失败"),this.initIconData()},initIconData(){t.post("api/getIconFile",{itemname:""}).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.allIcon=e}}))},handleSelect(a){var t=this.ctx.appContext.config.globalProperties;console.log(this.itemNameCache[a.value]),"1"==this.awardData.type?(this.awardData.couCurrType="",this.awardData.itemchinese=a.value,this.awardData.itemname=this.itemNameCache[a.value].itemname,this.awardData.itemicon=(this.itemNameCache[a.value].icon?this.itemNameCache[a.value].icon.Value:this.itemNameCache[a.value].itemname)+".png",this.awardData.itemtint=null===this.itemNameCache[a.value].tint?"1|1|1|1":this.itemNameCache[a.value].tint,t.$LoadTintImage(e("#imgDesc")[0],this.awardData.itemicon,this.awardData.itemtint),e("#imgDesc").show()):this.awardData.couCurrType=a.value},handleDelete(a){l.confirm("确定要删除这个商品吗？").then((e=>{if("confirm"===e){let e={id:a+""};t.post("api/deleteSignInfo",e).then((a=>{"1"===a.data.respCode?i({message:"删除成功!",type:"success"}):i.error("删除失败"),this.initTableData()}))}})).catch((()=>{}))},handleAddDelete(a){l.confirm("确定要删除这个商品吗？").then((e=>{if("confirm"===e){let e={id:a+""};t.post("api/deleteAwardInfo",e).then((a=>{"1"===a.data.respCode?i({message:"删除成功!",type:"success"}):i.error("删除失败");let e={containerid:this.awardData.containerid+"",funcid:"4"};t.post("api/getAwardInfo",e).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.awardInfo=e,this.awardAddVisible=!1}}))}))}})).catch((()=>{}))},initTableData(){t.post("api/getSignInfo",{itemname:""}).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.queryData=e}}))},submitForm(a){this.$refs[a].validate((a=>{if(!a)return!1;{let a="";a="-1"==this.formData.id?"api/postSignInfo":"api/updateSignInfo",this.formData.quality=this.formData.quality+"",t.post(a,this.formData).then((a=>{"1"===a.data.respCode?i({message:"保存成功!",type:"success"}):i.error("保存出错"),this.addVisible=!1,this.initTableData()}))}}))},submitAddForm(a){this.$refs[a].validate((a=>{if(!a)return!1;{let a="";a="-1"==this.awardData.id?"api/postAwardInfo":"api/updateAwardInfo",this.awardData.itemquality=this.awardData.itemquality+"",this.awardData.couDate&&2===this.awardData.couDate.length&&(this.awardData.couDateStart=this.awardData.couDate[0],this.awardData.couDateEnd=this.awardData.couDate[1],this.awardData.couDate=""),t.post(a,this.awardData).then((a=>{"1"===a.data.respCode?i({message:"保存成功!",type:"success"}):i.error("保存出错");let e={containerid:this.awardData.containerid+"",funcid:"1"};t.post("api/getAwardInfo",e).then((a=>{if("1"===a.data.respCode){let e=a.data.data;this.awardInfo=e,this.awardAddVisible=!1}}))}))}}))},openUpdate(a){this.addVisible=!0,this.formData.id=a.row.id+"",null==a.row.date||a.row.date.startsWith("0")?this.formData.date="":this.formData.date=a.row.date,this.formData.day=a.row.day,this.formData.type=a.row.type,this.formData.count=a.row.count+"",this.formData.itemname=a.row.itemname+"",this.formData.quality=a.row.quality+"",null==a.row.quality&&"0"==a.row.quality||(this.formData.quality=parseInt(a.row.quality)),this.formData.itemchinese=a.row.itemchinese+"",this.formData.itemicon=a.row.itemicon+"",this.formData.itemtint=a.row.itemtint+""},openAddUpdate(a){this.awardAddVisible=!0,this.awardData.id=a.row.id+"",this.awardData.type=a.row.type+"",this.awardData.containerid=a.row.containerid+"",this.awardData.count=a.row.count+"",this.awardData.itemname=a.row.itemname+"",this.awardData.itemquality=a.row.itemquality+"",this.awardData.itemchinese=a.row.itemchinese+"",this.awardData.itemicon=a.row.itemicon+"",this.awardData.itemtint=a.row.itemtint+"",this.awardData.command=a.row.command+"",this.awardData.couCurrType=a.row.couCurrType+"",this.awardData.couPrice=a.row.couPrice+"",this.awardData.couCond=a.row.couCond+"",this.awardData.coudatelimit=a.row.coudatelimit+"",this.awardData.couDateStart=a.row.couDateStart+"",this.awardData.couDateEnd=a.row.couDateEnd+"",this.awardData.couDate=[this.awardData.couDateStart,this.awardData.couDateEnd]},openAwardEdit(a){this.$store.state.awardEditVisible=!0,this.cid=a.row.id},resetForm(a){this.$refs[a].resetFields()},discountchange(){this.formData.prefer=(parseInt(this.formData.price)*(this.formData.discount/10)).toFixed(2)+""},preferchange(){parseInt(this.formData.prefer)>parseInt(this.formData.price)&&(this.formData.price=this.formData.prefer,this.formData.discount=10),this.formData.discount=(parseInt(this.formData.prefer)/parseInt(this.formData.price)*10).toFixed(2)},catchs(a){},handleAdd(){this.formData.id="-1",this.addVisible=!0},handleAddAward(){this.awardData.id="-1",this.awardAddVisible=!0},loadCouCurr(a,e){e([{value:"积分折扣"},{value:"积分满减"},{value:"钻石折扣"},{value:"钻石满减"}])}}},w={class:"crumbs"},y=d("i",{class:"el-icon-lx-cascades"},null,-1),g=m(" 基础表格 "),b={class:"container"},C={class:"handle-box"},v=m("添加"),V={key:0},k={key:1},I={key:2},_={key:3},A={key:4},S=m("编辑任务 "),q=m("编辑奖品 "),x=m("删除 "),N={class:"infinite-list",style:{"overflow-x":"scroll"}},F=m("添加新图片"),T=d("img",{class:"imgDesc",style:{display:"none"}},null,-1),U=d("br",null,null,-1),E={class:"dialog-footer"},Y=m("确 定"),L=m("取 消"),M=m("重 置");D.render=function(a,e,t,i,l,f){const D=o("el-breadcrumb-item"),$=o("el-breadcrumb"),P=o("el-button"),j=o("el-table-column"),z=o("el-table"),W=o("el-option"),B=o("el-select"),G=o("el-tooltip"),J=o("el-form-item"),O=o("el-date-picker"),H=o("el-autocomplete"),K=o("el-tag"),Q=o("el-upload"),R=o("el-image"),X=o("el-input"),Z=o("el-slider"),aa=o("el-form"),ea=o("el-dialog"),ta=o("AawrdComponent");return s(),r("div",null,[d("div",w,[d($,{separator:"/"},{default:n((()=>[d(D,null,{default:n((()=>[y,g])),_:1})])),_:1})]),d("div",b,[d("div",C,[d(P,{type:"success",icon:"el-icon-plus",onClick:f.handleAdd},{default:n((()=>[v])),_:1},8,["onClick"])]),d(z,{border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header",data:l.queryData},{default:n((()=>[d(j,{prop:"id",label:"ID",width:"55",align:"center"}),d(j,{label:"签到日期"},{default:n((a=>[m(c(f.handleSignDate(a)),1)])),_:1}),d(j,{label:"补签设置"},{default:n((a=>["-1"==a.row.type?(s(),r("span",V," 禁止补签 ")):u("",!0),"1"==a.row.type?(s(),r("span",k," 可使用"+c(a.row.count)+"积分补签 ",1)):u("",!0),"2"==a.row.type?(s(),r("span",I," 可使用"+c(a.row.count)+"点券补签 ",1)):u("",!0),"3"==a.row.type?(s(),r("span",_," 可以使用"+c(a.row.count)+"个"+c(a.row.itemchinese)+" （品质："+c(a.row.quality)+"）补签 ",1)):u("",!0),"4"==a.row.type?(s(),r("span",A," 可以使用"+c(a.row.count)+"个"+c(a.row.itemchinese)+"补签 ",1)):u("",!0)])),_:1}),d(j,{label:"操作",width:"350",align:"center"},{default:n((a=>[d(P,{type:"primary",icon:"el-icon-edit",size:"small",onClick:e=>f.openUpdate(a)},{default:n((()=>[S])),_:2},1032,["onClick"]),d(P,{type:"success",icon:"el-icon-edit",size:"small",onClick:e=>f.openAwardEdit(a)},{default:n((()=>[q])),_:2},1032,["onClick"]),d(P,{type:"delete",icon:"el-icon-delete",size:"small",class:"red",onClick:e=>f.handleDelete(a.row.id)},{default:n((()=>[x])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),d(ea,{title:"新增",modelValue:l.addVisible,"onUpdate:modelValue":e[14]||(e[14]=a=>l.addVisible=a),width:"40%","append-to-body":!0},{footer:n((()=>[d("span",E,[d(P,{type:"primary",onClick:e[11]||(e[11]=a=>f.submitForm("formData"))},{default:n((()=>[Y])),_:1}),d(P,{onClick:e[12]||(e[12]=a=>l.addVisible=!1)},{default:n((()=>[L])),_:1}),d(P,{onClick:e[13]||(e[13]=a=>f.resetForm("formData"))},{default:n((()=>[M])),_:1})])])),default:n((()=>[d(aa,{rules:l.rules,ref:"formData",model:l.formData},{default:n((()=>[d(J,{label:"签到星期",class:"center"},{default:n((()=>[d(G,{content:"如果只选择周几，不选择日期，则每个所选的周几都可以领取，如果选择了日期，到指定日期才可以领取，日期优先",placement:"top"},{default:n((()=>[d(B,{modelValue:l.formData.day,"onUpdate:modelValue":e[1]||(e[1]=a=>l.formData.day=a),placeholder:"签到星期",class:"handle-space",disabled:l.isDayDisable},{default:n((()=>[d(W,{key:"1",label:"星期一",value:"1"}),d(W,{key:"2",label:"星期二",value:"2"}),d(W,{key:"3",label:"星期三",value:"3"}),d(W,{key:"4",label:"星期四",value:"4"}),d(W,{key:"5",label:"星期五",value:"5"}),d(W,{key:"6",label:"星期六",value:"6"}),d(W,{key:"0",label:"星期日",value:"0"})])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1}),d(J,{label:"签到日期",class:"center"},{default:n((()=>[d(O,{onChange:f.changeDate,modelValue:l.formData.date,"onUpdate:modelValue":e[2]||(e[2]=a=>l.formData.date=a),align:"right",type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"默认即日起"},null,8,["onChange","modelValue"])])),_:1}),d(J,{label:"补签消耗",class:"center"},{default:n((()=>[d(B,{modelValue:l.formData.type,"onUpdate:modelValue":e[3]||(e[3]=a=>l.formData.type=a),placeholder:"补签消耗",class:"handle-space"},{default:n((()=>[d(W,{key:"-1",label:"禁止补签",value:"-1"}),d(W,{key:"1",label:"积分",value:"1"}),d(W,{key:"2",label:"点券",value:"2"}),d(W,{key:"3",label:"游戏内物品",value:"3"}),d(W,{key:"4",label:"特殊物品",value:"4"})])),_:1},8,["modelValue"])])),_:1}),"4"==l.formData.type?(s(),r(h,{key:0},[d(J,{label:"物品名称",class:"center"},{default:n((()=>[d(H,{style:{width:"70%"},modelValue:l.formData.itemname,"onUpdate:modelValue":e[4]||(e[4]=a=>l.formData.itemname=a),"fetch-suggestions":f.loadCouCurr,placeholder:"请选择系统预置特殊物品，或者输入自定义物品",onSelect:f.handleSelectLottery,onInput:e[5]||(e[5]=a=>{l.formData.itemchinese=a,l.formData.itemname=a})},null,8,["modelValue","fetch-suggestions","onSelect"])])),_:1}),d(J,{class:"center"},{default:n((()=>[d("ul",N,[d(Q,{action:"api/uploadFile",multiple:"","on-success":f.handleAvatarSuccess,"on-error":f.handleAvatarFaild,style:{float:"left",width:"100px",height:"100px"}},{default:n((()=>[d(K,{style:{"margin-top":"35px"}},{default:n((()=>[F])),_:1})])),_:1},8,["on-success","on-error"]),(s(!0),r(h,null,p(l.allIcon,(a=>(s(),r("li",{key:a,class:"infinite-list-item",ref:l.imglist},[d(R,{class:{selected:a===l.formData.itemicon},style:{width:"100px",height:"100px",cursor:"pointer"},src:"api/image/"+a,onClick:e=>f.handleSelectImageLottery(a)},null,8,["class","src","onClick"])],512)))),128))])])),_:1})],64)):u("",!0),"3"==l.formData.type?(s(),r(h,{key:1},[d(J,{label:"物品名称",class:"center"},{default:n((()=>[d(H,{style:{width:"70%"},minlength:2,modelValue:l.formData.itemchinese,"onUpdate:modelValue":e[6]||(e[6]=a=>l.formData.itemchinese=a),"fetch-suggestions":f.querySearchAsync,placeholder:"请输入内容",onSelect:f.handleSelectLottery},null,8,["modelValue","fetch-suggestions","onSelect"])])),_:1}),d(J,{label:"系统名称",class:"center"},{default:n((()=>[d(X,{style:{width:"70%"},minlength:2,modelValue:l.formData.itemname,"onUpdate:modelValue":e[7]||(e[7]=a=>l.formData.itemname=a),placeholder:"请输入内容"},null,8,["modelValue"])])),_:1}),d(J,{class:"center"},{default:n((()=>[T])),_:1}),d(J,{label:"品质",class:"center"},{default:n((()=>[d(Z,{modelValue:l.formData.quality,"onUpdate:modelValue":e[8]||(e[8]=a=>l.formData.quality=a),"show-tooltip":!0,step:1,max:6,"show-stops":"","show-input":"",marks:a.marks},null,8,["modelValue","marks"])])),_:1}),U],64)):u("",!0),d(J,{label:" 数量 ",class:"center"},{default:n((()=>[d(X,{class:"handle-space",placeholder:"请输入补签消耗指定物品数量",modelValue:l.formData.count,"onUpdate:modelValue":e[9]||(e[9]=a=>l.formData.count=a),onInput:e[10]||(e[10]=()=>{})},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"]),d(ta,{fid:l.fid,cid:l.cid},null,8,["fid","cid"])])};export default D;
